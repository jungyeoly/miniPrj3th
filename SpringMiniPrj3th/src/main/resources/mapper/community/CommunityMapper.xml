<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.example.myapp.community.dao.ICommunityRepository">

	<select id="selectArticleListByCommunity"
		parameterType="String"
		resultType="com.example.myapp.community.model.Community">
	<![CDATA[
		SELECT 
			write_id 			AS "writeId", 
			user_id				AS "userId",	
			write_title			AS "writeTitle",
			write_date			AS "writeDate"
		 FROM community

	]]>
	</select>


	<select id="selectArticle" parameterType="hashmap"
		resultType="com.example.myapp.community.model.Community">
	<![CDATA[
		SELECT 
			write_id			AS "writeId", 
			user_id						AS "userId", 
			write_title					AS "writeTitle",
			write_date					AS "writeDate",
			 write_content				AS "writeContent" 
		FROM community
		WHERE write_id=#{writeId}
	]]>
	</select>


	<select id="selectMaxArticleNo" parameterType="int"
		resultType="int">
	<![CDATA[
		SELECT 
			NVL(MAX(write_id),0) AS "articleNo"
		FROM community
	]]>
	</select>

	<select id="selectMaxFileId" parameterType="int"
		resultType="int">
	<![CDATA[
		SELECT 
			NVL(MAX(file_id),0) AS "fileId"
		FROM community_upload_file
	]]>
	</select>

	<insert id="insertArticle"
		parameterType="com.example.myapp.community.model.Community">
	<![CDATA[
		INSERT INTO 
		COMMUNITY 
		(write_id, write_date, write_title, write_content, user_id)  
		VALUES 
			(community_seq.nextval, SYSDATE, #{writeTitle}, #{writeContent}, #{userId} )
	]]>
	</insert>





	<update id="updateArticle"
		parameterType="com.example.myapp.community.model.Community">
	<![CDATA[
		UPDATE 
			community 
		SET 
			 user_id=#{userId}, 
			 write_title=#{wirteTitle}, 
			write_content=#{writeContent}, write_date=SYSDATE 
		WHERE 
			write_id=#{writeId}
	]]>
	</update>


		<delete id="deleteArticleByWriteId" parameterType="int">
		DELETE FROM 
			community 
		WHERE 
			write_id=#{writeId}
	</delete>




	<select id="searchListByContentKeyword" parameterType="hashmap"
		resultType="com.example.myapp.community.model.Community">
	<![CDATA[
		SELECT 
			write_id 				AS "writeId", 
			user_id					AS "userId", 
			write_title				AS "writeTitle", 
			write_date				AS "writeDate"
			
	    FROM (
	    	SELECT 
	    		write_id, 
	    		user_id, 
	    		write_title, 
	    		write_date, 
	    		write_content
	    	FROM (
	    		SELECT * FROM community
	    		WHERE
	    			write_title LIKE #{keyword}
		    		OR 
		    		write_content LIKE #{keyword}
		    		OR 
		    		user_id LIKE #{keyword}
	    	)
	    )
	   
	]]>
	</select>
</mapper>	